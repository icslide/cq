<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é‡åº†å¸‚è‚²ä»ä¸­å­¦æ ¡2025å¹´ä¼šæŠ½å¥–ç³»ç»Ÿ</title>
    <style>
        /* å…¨å±€æ ·å¼é‡ç½® */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: "Microsoft YaHei", "å¾®è½¯é›…é»‘", sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1a2980 0%, #26d0ce 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            padding: 30px 20px;
            position: relative;
        }

        /* ä¸»å®¹å™¨ï¼šæŠ½å¥–åŒº+åå•åŒºæ¨ªå‘å¸ƒå±€ */
        .main-wrap {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
            max-width: 1600px; /* å¢åŠ æ€»å®½åº¦ */
            width: 100%;
            margin: 0 auto;
        }

        /* æŠ½å¥–ä¸»å®¹å™¨ */
        .lottery-container {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 24px;
            padding: 60px 80px;
            box-shadow: 0 25px 70px rgba(0, 0, 0, 0.35);
            text-align: center;
            flex: 1;
            min-width: 700px; /* å¢åŠ æœ€å°å®½åº¦ */
        }

        /* ä¸­å¥–åå•æ‚¬æµ®æ¨¡å— - ä¼˜åŒ–æ˜¾ç¤º */
        .win-list-aside {
            background: rgba(255, 255, 255, 0.98);
            border-radius: 16px;
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.25);
            width: 550px; /* æ˜¾è‘—å¢åŠ å®½åº¦ */
            max-height: 80vh;
            overflow-y: auto;
            position: sticky;
            top: 30px;
            display: flex;
            flex-direction: column;
        }
        
        /* åå•å¤´éƒ¨ */
        .win-list-header {
            padding: 15px 25px; /* å¢åŠ å†…è¾¹è· */
            background-color: #1a2980;
            border-radius: 16px 16px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 10;
        }
        
        .win-list-title {
            font-size: 20px; /* å¢å¤§å­—ä½“ */
            color: white;
            font-weight: 600;
        }
        
        .win-list-oper {
            display: flex;
            gap: 10px; /* å¢åŠ æŒ‰é’®é—´è· */
        }
        
        .list-btn {
            padding: 6px 12px; /* å¢å¤§æŒ‰é’® */
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px; /* å¢å¤§å­—ä½“ */
            color: white;
            background-color: rgba(255,255,255,0.3);
            transition: all 0.2s ease;
            white-space: nowrap; /* é˜²æ­¢æ–‡å­—æ¢è¡Œ */
        }
        
        .list-btn:hover {
            background-color: rgba(255,255,255,0.5);
        }
        
        /* æ–°å¢ï¼šæ¸…ç©ºè®°å½•æŒ‰é’®ç‰¹æ®Šæ ·å¼ */
        .list-btn.clear-all-btn {
            background-color: rgba(231, 76, 60, 0.8); /* çº¢è‰²èƒŒæ™¯ */
        }
        
        .list-btn.clear-all-btn:hover {
            background-color: rgba(231, 76, 60, 1); /* æ·±çº¢è‰²æ‚¬åœ */
        }
        
        /* åå•å†…å®¹åŒº - ä¼˜åŒ–é—´è· */
        .win-list-content {
            padding: 15px 20px; /* ä¼˜åŒ–å†…è¾¹è· */
            flex: 1;
            overflow-y: auto;
        }
        
        /* ä¸­å¥–è®°å½•é¡¹ - ä¼˜åŒ–é—´è·å’Œæ˜¾ç¤º */
        .win-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px 10px; /* ä¼˜åŒ–å†…è¾¹è· */
            border-bottom: 1px solid #e0e0e0;
            font-size: 15px; /* å¢å¤§å­—ä½“ */
            min-height: 50px; /* æœ€å°é«˜åº¦ä¿è¯é—´è· */
            transition: background-color 0.2s ease;
        }
        
        .win-item:hover {
            background-color: #f8f9fa;
        }
        
        .win-item:last-child {
            border-bottom: none;
        }
        
        /* åºå·åˆ—æ ·å¼ */
        .win-index {
            width: 45px; /* ä¼˜åŒ–å®½åº¦ */
            text-align: center;
            color: #666;
            font-weight: 600;
            font-size: 14px; /* å¢å¤§å­—ä½“ */
            flex-shrink: 0; /* é˜²æ­¢å‹ç¼© */
        }
        
        /* è½®æ•°åˆ— */
        .win-round {
            width: 65px; /* ä¼˜åŒ–å®½åº¦ */
            text-align: center;
            color: #f39c12;
            font-weight: 600;
            font-size: 14px; /* å¢å¤§å­—ä½“ */
            flex-shrink: 0;
        }
        
        /* ç±»å‹åˆ— */
        .win-type {
            width: 70px; /* ä¼˜åŒ–å®½åº¦ */
            text-align: center;
            color: #1a2980;
            font-weight: 600;
            font-size: 14px; /* å¢å¤§å­—ä½“ */
            flex-shrink: 0;
        }
        
        /* å†…å®¹åˆ— - ä¼˜åŒ–é—´è·å’Œæ˜¾ç¤º */
        .win-content {
            flex: 1;
            text-align: left;
            padding: 0 15px; /* ä¼˜åŒ–å·¦å³é—´è· */
            color: #333;
            font-size: 16px; /* æ˜¾è‘—å¢å¤§å­—ä½“ */
            word-break: break-word; /* è‡ªåŠ¨æ¢è¡Œ */
            overflow-wrap: break-word;
            line-height: 1.5; /* ä¼˜åŒ–è¡Œé«˜ */
            max-width: 200px; /* ä¼˜åŒ–æœ€å¤§å®½åº¦ */
            margin: 0 5px; /* æ·»åŠ å¤–è¾¹è· */
        }
        
        /* æ—¶é—´åˆ— */
        .win-time {
            width: 130px; /* ä¼˜åŒ–å®½åº¦ */
            text-align: right;
            color: #666;
            font-size: 13px; /* ä¼˜åŒ–å­—ä½“å¤§å° */
            white-space: nowrap; /* é˜²æ­¢æ—¶é—´æ¢è¡Œ */
            flex-shrink: 0;
        }
        
        .empty-win-tip {
            text-align: center;
            color: #999;
            font-size: 16px; /* å¢å¤§å­—ä½“ */
            padding: 40px 30px; /* ä¼˜åŒ–å†…è¾¹è· */
            font-style: italic;
        }
        
        /* åå•æ”¶èµ·æ ·å¼ */
        .win-list-aside.collapse {
            width: 50px; /* å¢åŠ æ”¶èµ·å®½åº¦ */
            overflow: hidden;
        }
        
        .win-list-aside.collapse .win-list-header .win-list-title,
        .win-list-aside.collapse .win-list-oper .list-btn:not(.collapse-btn),
        .win-list-aside.collapse .win-list-content {
            display: none;
        }
        
        .win-list-aside.collapse .win-list-header {
            justify-content: center;
            padding: 15px;
        }
        
        .win-list-aside.collapse .collapse-btn {
            transform: rotate(180deg);
        }

        /* æŠ½å¥–æ ‡é¢˜æ ·å¼ */
        .lottery-title {
            font-size: 46px;
            color: #1a2980;
            margin-bottom: 40px;
            font-weight: bold;
            text-shadow: 2px 2px 6px rgba(0,0,0,0.12);
        }

        /* åˆ‡æ¢æ ‡ç­¾ */
        .tab-switch {
            display: flex;
            justify-content: center;
            margin-bottom: 30px;
            gap: 10px;
        }

        .tab-btn {
            padding: 12px 30px;
            font-size: 20px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            background-color: #e8f4f8;
            color: #1a2980;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            background-color: #1a2980;
            color: white;
        }

        .tab-btn:hover:not(.active) {
            background-color: #d1e7dd;
        }

        /* åé¢é€‰æ‹©åŒºåŸŸ */
        .quota-select {
            margin: 20px 0 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
        }

        .quota-label {
            font-size: 22px;
            color: #2c3e50;
            font-weight: 600;
        }

        .quota-btn {
            padding: 10px 30px;
            font-size: 18px;
            border: 2px solid #26d0ce;
            border-radius: 8px;
            cursor: pointer;
            background-color: white;
            color: #1a2980;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .quota-btn.active {
            background-color: #1a2980;
            color: white;
            border-color: #1a2980;
        }

        /* å†…å®¹åŒºåŸŸ */
        .content-panel {
            display: none;
        }

        .content-panel.active {
            display: block;
        }

        /* èŒƒå›´è®¾ç½®åŒºåŸŸ */
        .range-setting {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .range-label {
            font-size: 22px;
            color: #2c3e50;
            font-weight: 600;
        }

        .range-input {
            padding: 14px 18px;
            font-size: 20px;
            border: 2px solid #26d0ce;
            border-radius: 10px;
            width: 130px;
            text-align: center;
            outline: none;
        }

        .range-input:focus {
            border-color: #1a2980;
            box-shadow: 0 0 10px rgba(26, 41, 128, 0.25);
        }

        .range-separator {
            font-size: 26px;
            color: #7f8c8d;
            font-weight: bold;
        }

        /* Excelå¯¼å…¥åŒºåŸŸ - å¯æŠ˜å  */
        .excel-import {
            margin: 0 auto 20px;
            padding: 25px;
            background-color: #f8f9fa;
            border-radius: 15px;
            border: 2px solid #26d0ce;
            max-width: 650px;
            position: relative;
            transition: all 0.3s ease;
            overflow: hidden;
        }

        .excel-import.collapsed {
            max-height: 60px;
            padding: 15px 25px;
        }

        /* Excelå¯¼å…¥å¤´éƒ¨ - å¯ç‚¹å‡»æŠ˜å  */
        .excel-import-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            cursor: pointer;
        }

        .excel-import.collapsed .excel-import-header {
            margin-bottom: 0;
        }

        .import-label {
            font-size: 22px;
            color: #2c3e50;
            font-weight: 600;
            display: block;
        }

        .collapse-toggle {
            background: none;
            border: none;
            font-size: 24px;
            color: #1a2980;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .collapse-toggle:hover {
            background-color: rgba(26, 41, 128, 0.1);
            transform: scale(1.1);
        }

        .excel-import.collapsed .collapse-toggle {
            transform: rotate(180deg);
        }

        .excel-import-content {
            transition: all 0.3s ease;
            opacity: 1;
            max-height: 500px;
            overflow: hidden;
        }

        .excel-import.collapsed .excel-import-content {
            opacity: 0;
            max-height: 0;
            margin: 0;
        }

        /* æ–‡ä»¶ä¸Šä¼ æ ·å¼ */
        .file-upload {
            position: relative;
            display: inline-block;
            cursor: pointer;
            margin-bottom: 20px;
        }

        .upload-btn {
            display: inline-block;
            padding: 12px 40px;
            font-size: 18px;
            background-color: #26d0ce;
            color: white;
            border-radius: 8px;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .upload-btn:hover {
            background-color: #1a2980;
        }

        #excelFile {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            opacity: 0;
            cursor: pointer;
        }

        .file-name {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 15px;
            display: block;
        }

        .parse-btn {
            padding: 10px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            background-color: #1a2980;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-bottom: 15px;
        }

        .parse-btn:hover {
            background-color: #27ae60;
        }

        .tip-text {
            font-size: 16px;
            color: #7f8c8d;
            margin-bottom: 10px;
            line-height: 1.5;
        }

        .name-count-tip {
            font-size: 18px;
            color: #27ae60;
            font-weight: 600;
            margin-top: 10px;
        }

        /* æ˜¾ç¤ºåŒºåŸŸï¼ˆæ•°å­—/å§“åï¼‰ */
        .display-area {
            font-size: 40px;
            font-weight: bold;
            color: #e74c3c;
            margin: 40px 0;
            min-height: 280px;
            line-height: 60px;
            border: 6px solid #26d0ce;
            border-radius: 20px;
            background-color: #f8f9fa;
            letter-spacing: 4px;
            box-shadow: inset 0 0 25px rgba(0,0,0,0.08);
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        .winner-item {
            background-color: #fff;
            padding: 10px 20px;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 5px;
        }

        /* æŠ½å¥–æŒ‰é’®æ ·å¼ï¼ˆå•æŒ‰é’®ï¼‰ */
        .lottery-btn {
            padding: 25px 80px;
            font-size: 32px;
            border: none;
            border-radius: 15px;
            cursor: pointer;
            font-weight: 700;
            transition: all 0.3s ease;
            min-width: 300px;
        }
        
        /* å¼€å§‹æŠ½å¥–æ ·å¼ï¼ˆç»¿è‰²ï¼‰ */
        .lottery-btn.start {
            background-color: #27ae60;
            color: white;
        }
        
        .lottery-btn.start:hover {
            background-color: #219653;
            transform: scale(1.05);
        }
        
        /* åœæ­¢æŠ½å¥–æ ·å¼ï¼ˆçº¢è‰²ï¼‰ */
        .lottery-btn.stop {
            background-color: #e74c3c;
            color: white;
        }
        
        .lottery-btn.stop:hover {
            background-color: #d32f2f;
            transform: scale(1.05);
        }

        /* ä¸­å¥–æç¤º */
        .win-tip {
            font-size: 36px;
            color: #f39c12;
            margin: 30px 0 0;
            font-weight: bold;
            display: none;
            text-shadow: 2px 2px 5px rgba(0,0,0,0.15);
            animation: bounce 1s ease infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0); }
            to { transform: translateY(-12px); }
        }

        /* ç®¡ç†å…¥å£ */
        .admin-entrance {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 10px 20px;
            background-color: rgba(26, 41, 128, 0.8);
            color: white;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            text-decoration: none;
            transition: all 0.3s ease;
            z-index: 999;
        }

        .admin-entrance:hover {
            background-color: #1a2980;
        }

        /* è½®æ•°æ˜¾ç¤ºæ ·å¼ï¼ˆæ–°å¢ï¼‰ */
        .round-display {
            font-size: 20px;
            color: #1a2980;
            margin: 10px 0 20px;
            font-weight: 600;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
        }

        /* è½®æ•°æ§åˆ¶æŒ‰é’® */
        .round-control-btn {
            padding: 5px 15px;
            font-size: 16px;
            border: 1px solid #1a2980;
            border-radius: 6px;
            cursor: pointer;
            background-color: white;
            color: #1a2980;
            transition: all 0.2s ease;
        }

        .round-control-btn:hover {
            background-color: #1a2980;
            color: white;
        }

        /* å‰©ä½™åé¢æç¤ºï¼ˆæ–°å¢ï¼‰- ç®€åŒ–ç‰ˆæœ¬ */
        .remaining-tip {
            font-size: 16px;
            color: #27ae60;
            margin: 10px 0;
            font-weight: 500;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ä¼˜åŒ– */
        .win-list-content::-webkit-scrollbar {
            width: 6px;
        }
        
        .win-list-content::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .win-list-content::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        .win-list-content::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }

        /* å“åº”å¼é€‚é… */
        @media (max-width: 1200px) {
            .main-wrap {
                flex-direction: column;
                align-items: center;
                max-width: 1000px;
            }
            
            .lottery-container {
                min-width: 100%;
                padding: 40px 30px;
            }
            
            .win-list-aside {
                width: 100%;
                max-height: 400px;
                position: static;
            }
            
            .lottery-title {
                font-size: 32px;
            }
            
            .display-area {
                font-size: 28px;
                min-height: 200px;
                line-height: 40px;
                letter-spacing: 2px;
            }
            
            .lottery-btn {
                padding: 20px 60px;
                font-size: 24px;
                min-width: 200px;
            }
            
            .range-input {
                width: 100px;
                font-size: 18px;
            }
            
            .quota-btn {
                padding: 8px 20px;
                font-size: 16px;
            }
            
            .excel-import {
                padding: 20px;
                max-width: 100%;
            }
            
            .excel-import.collapsed {
                max-height: 55px;
                padding: 12px 20px;
            }
            
            .win-tip {
                font-size: 28px;
            }
            
            .round-display {
                font-size: 18px;
                flex-wrap: wrap;
            }
            
            /* å“åº”å¼åå•æ ·å¼ */
            .win-item {
                padding: 10px 8px;
            }
            
            .win-index {
                width: 40px;
                font-size: 13px;
            }
            
            .win-round {
                width: 60px;
                font-size: 13px;
            }
            
            .win-type {
                width: 65px;
                font-size: 13px;
            }
            
            .win-content {
                font-size: 14px;
                padding: 0 12px;
                max-width: 180px;
                line-height: 1.4;
            }
            
            .win-time {
                width: 110px;
                font-size: 12px;
            }
            
            /* æŒ‰é’®å“åº”å¼è°ƒæ•´ */
            .win-list-oper {
                gap: 5px;
            }
            
            .list-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
        }

        @media (max-width: 768px) {
            .main-wrap {
                gap: 15px;
            }
            
            .lottery-container {
                padding: 30px 20px;
            }
            
            .lottery-title {
                font-size: 26px;
                margin-bottom: 25px;
            }
            
            .win-list-aside {
                max-height: 350px;
            }
            
            .win-list-header {
                padding: 12px 15px;
            }
            
            .win-list-title {
                font-size: 16px;
            }
            
            .list-btn {
                padding: 4px 8px;
                font-size: 12px;
            }
            
            .win-item {
                padding: 8px 5px;
                font-size: 13px;
                min-height: 45px;
            }
            
            .win-index {
                width: 35px;
                font-size: 11px;
            }
            
            .win-round {
                width: 50px;
                font-size: 11px;
            }
            
            .win-type {
                width: 55px;
                font-size: 11px;
            }
            
            .win-content {
                font-size: 12px;
                padding: 0 8px;
                max-width: 150px;
                line-height: 1.3;
                margin: 0 3px;
            }
            
            .win-time {
                width: 90px;
                font-size: 10px;
            }
            
            .display-area {
                font-size: 22px;
                min-height: 150px;
                padding: 15px;
            }
            
            .lottery-btn {
                padding: 15px 40px;
                font-size: 20px;
            }
            
            .win-tip {
                font-size: 22px;
            }
            
            .excel-import-header {
                margin-bottom: 15px;
            }
            
            .excel-import.collapsed {
                max-height: 50px;
                padding: 10px 15px;
            }
            
            .import-label {
                font-size: 18px;
            }
            
            .collapse-toggle {
                font-size: 20px;
                width: 32px;
                height: 32px;
            }
            
            /* å°å±å¹•æŒ‰é’®è°ƒæ•´ */
            .win-list-oper {
                flex-wrap: wrap;
                justify-content: flex-end;
            }
            
            .empty-win-tip {
                padding: 30px 20px;
                font-size: 14px;
            }
        }

        @media (max-width: 480px) {
            .win-list-aside {
                max-height: 300px;
            }
            
            .win-item {
                padding: 6px 3px;
                min-height: 40px;
            }
            
            .win-index {
                width: 30px;
                font-size: 10px;
            }
            
            .win-round {
                width: 45px;
                font-size: 10px;
            }
            
            .win-type {
                width: 50px;
                font-size: 10px;
            }
            
            .win-content {
                font-size: 11px;
                padding: 0 5px;
                max-width: 120px;
                line-height: 1.2;
            }
            
            .win-time {
                width: 80px;
                font-size: 9px;
            }
            
            .win-list-oper {
                gap: 3px;
            }
            
            .list-btn {
                padding: 3px 6px;
                font-size: 11px;
            }
        }
    </style>
    <!-- å¼•å…¥å¤„ç†Excelçš„ç¬¬ä¸‰æ–¹åº“ -->
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
</head>
<body>
    <!-- ç®¡ç†é¡µé¢å…¥å£ -->
    <a href="admin.html" class="admin-entrance">---</a>

    <!-- ä¸»å®¹å™¨ï¼ŒåŒ…å«æŠ½å¥–åŒºå’Œåå•åŒº -->
    <div class="main-wrap">
        <!-- åŸæœ‰æŠ½å¥–å®¹å™¨ -->
        <div class="lottery-container">
            <h1 class="lottery-title">é‡åº†å¸‚è‚²ä»ä¸­å­¦æ ¡2025å¹´ä¼šæŠ½å¥–</h1>
            
            <!-- æ–°å¢ï¼šå½“å‰æŠ½å¥–è½®æ•°æ˜¾ç¤º + è½®æ•°æ§åˆ¶æŒ‰é’® -->
            <div class="round-display" id="roundDisplay">
                <span>å½“å‰æŠ½å¥–è½®æ•°ï¼š</span>
                <button class="round-control-btn" id="prevRoundBtn">ä¸Šä¸€è½®</button>
                <span id="currentRoundText">ç¬¬ 1 è½®</span>
                <button class="round-control-btn" id="nextRoundBtn">ä¸‹ä¸€è½®</button>
            </div>
            
            <!-- ä¿®æ”¹ï¼šå‰©ä½™å¯æŠ½å¥–åé¢æç¤º - ç§»é™¤é¢„è®¾å¯ç”¨ä¿¡æ¯ -->
            <div class="remaining-tip" id="remainingTip">å‰©ä½™å¯æŠ½å¥–åé¢ï¼š--</div>

            <!-- åˆ‡æ¢æ ‡ç­¾ï¼šæ•°å­—æŠ½å¥–/å§“åæŠ½å¥– -->
            <div class="tab-switch">
                <button class="tab-btn active" data-tab="number-tab">æ•°å­—æŠ½å¥–</button>
                <button class="tab-btn" data-tab="name-tab">æ•™å¸ˆå§“åæŠ½å¥–</button>
            </div>

            <!-- åé¢é€‰æ‹©åŒºåŸŸ -->
            <div class="quota-select">
                <span class="quota-label">æœ¬æ¬¡æŠ½å¥–åé¢ï¼š</span>
                <button class="quota-btn active" data-quota="1">1ä¸ªåé¢</button>
                <button class="quota-btn" data-quota="10">10ä¸ªåé¢</button>
            </div>

            <!-- æ•°å­—æŠ½å¥–é¢æ¿ -->
            <div class="content-panel active" id="number-tab">
                <div class="range-setting">
                    <span class="range-label">æŠ½å¥–èŒƒå›´ï¼š</span>
                    <input type="number" class="range-input" id="minNumInput" value="1" min="1" placeholder="æœ€å°å€¼">
                    <span class="range-separator">-</span>
                    <input type="number" class="range-input" id="maxNumInput" value="99" min="1" placeholder="æœ€å¤§å€¼">
                </div>
            </div>

            <!-- å§“åæŠ½å¥–é¢æ¿ï¼ˆExcelå¯¼å…¥ï¼‰- æ–°å¢æŠ˜å åŠŸèƒ½ -->
            <div class="content-panel" id="name-tab">
                <div class="excel-import" id="excelImportSection">
                    <div class="excel-import-header" id="excelImportHeader">
                        <span class="import-label">å¯¼å…¥æ•™å¸ˆå§“åï¼ˆExcelæ–‡ä»¶ï¼‰</span>
                        <button class="collapse-toggle" id="excelCollapseToggle">â–¼</button>
                    </div>
                    
                    <div class="excel-import-content" id="excelImportContent">
                        <!-- æ–‡ä»¶ä¸Šä¼ æŒ‰é’® -->
                        <div class="file-upload">
                            <span class="upload-btn">é€‰æ‹©Excelæ–‡ä»¶</span>
                            <input type="file" id="excelFile" accept=".xlsx, .xls">
                        </div>
                        <!-- æ˜¾ç¤ºé€‰ä¸­çš„æ–‡ä»¶å -->
                        <span class="file-name" id="fileName">æœªé€‰æ‹©æ–‡ä»¶</span>
                        <!-- è§£ææŒ‰é’® -->
                        <button class="parse-btn" id="parseExcelBtn" disabled>è§£æExcelåå•</button>
                        <!-- æç¤ºä¿¡æ¯ -->
                        <p class="tip-text">ğŸ“Œ æç¤ºï¼šExcelæ–‡ä»¶è¦æ±‚ - ç¬¬ä¸€åˆ—ä¸ºæ•™å¸ˆå§“åï¼Œæ— è¡¨å¤´ï¼ˆç¤ºä¾‹ï¼šA1=å¼ ä¸‰, A2=æå››, A3=ç‹äº”ï¼‰</p>
                        <p class="tip-text">æ”¯æŒæ ¼å¼ï¼š.xlsx / .xlsï¼Œè¯·å‹¿ä¸Šä¼ ç©ºæ–‡ä»¶æˆ–æ ¼å¼é”™è¯¯çš„æ–‡ä»¶</p>
                        <!-- å§“åæ•°é‡æç¤º -->
                        <p class="name-count-tip" id="nameCountTip">å½“å‰æœªå¯¼å…¥ä»»ä½•å§“å</p>
                    </div>
                </div>
            </div>

            <!-- æ˜¾ç¤ºåŒºåŸŸ -->
            <div class="display-area" id="displayArea">0</div>
            
            <!-- å•æŠ½å¥–æŒ‰é’® -->
            <button class="lottery-btn start" id="lotteryBtn">å¼€å§‹æŠ½å¥–</button>
            
            <!-- ä¸­å¥–æç¤º -->
            <div class="win-tip" id="winTip">æ­å–œä¸­å¥–ï¼ğŸ‰</div>
        </div>

        <!-- å³ä¾§ä¸­å¥–åå•å±•ç¤ºæ¨¡å—ï¼ˆåŠ å®½ç‰ˆï¼‰ -->
        <div class="win-list-aside" id="winListAside">
            <div class="win-list-header">
                <div class="win-list-title">ä¸­å¥–åå•å®æ—¶å±•ç¤º</div>
                <div class="win-list-oper">
                    <button class="list-btn refresh-list-btn" id="refreshListBtn">åˆ·æ–°</button>
                    <button class="list-btn clear-all-btn" id="clearAllListBtn">æ¸…ç©ºè®°å½•</button>
                    <button class="list-btn download-list-btn" id="downloadListBtn">ä¸‹è½½åå•</button>
                    <button class="list-btn collapse-btn" id="collapseListBtn">æ”¶èµ·</button>
                </div>
            </div>
            <div class="win-list-content" id="winListContent">
                <div class="empty-win-tip">æš‚æ— ä¸­å¥–è®°å½•</div>
            </div>
        </div>
    </div>

    <script>
        // ====================== å…¨å±€å˜é‡ ======================
        // æŠ½å¥–çŠ¶æ€
        let isLotteryRunning = false;
        // æŠ½å¥–å®šæ—¶å™¨
        let lotteryTimer = null;
        // å½“å‰é€‰ä¸­çš„æ ‡ç­¾ï¼ˆæ•°å­—/å§“åï¼‰
        let currentTab = 'number-tab';
        // å½“å‰é€‰ä¸­çš„æŠ½å¥–åé¢
        let currentQuota = 1;
        // å½“å‰æŠ½å¥–è½®æ•°
        let currentRound = parseInt(localStorage.getItem('lotteryCurrentRound')) || 1;
        // å·²ä¸­å¥–çš„å·ç /å§“åé›†åˆï¼ˆæ ¸å¿ƒï¼šé˜²é‡å¤ä¸­å¥–ï¼‰
        let wonSet = new Set(JSON.parse(localStorage.getItem('lotteryWonSet')) || []);
        // å¯¼å…¥çš„å§“ååˆ—è¡¨
        let nameList = JSON.parse(localStorage.getItem('lotteryNameList')) || [];
        // ä¸­å¥–åå•
        let winList = JSON.parse(localStorage.getItem('lotteryWinList')) || [];
        // é¢„è®¾ä¸­å¥–ç›¸å…³å˜é‡
        let presetEnabled = false;
        let presetNumbers = [];
        let presetNames = [];
        let presetUsedNumbers = new Set();
        let presetUsedNames = new Set();
        // ç”¨äºæŠ½å¥–æ»šåŠ¨çš„å…¨èŒƒå›´åˆ—è¡¨
        let allPossibleNumbers = [];
        let allPossibleNames = [];
        // å½“å‰å¯ç”¨å€™é€‰åˆ—è¡¨
        let availableCandidates = [];
        // é¢„è®¾å¯ç”¨å€™é€‰åˆ—è¡¨
        let presetCandidates = [];
        // Excelå¯¼å…¥åŒºåŸŸæŠ˜å çŠ¶æ€
        let excelImportCollapsed = localStorage.getItem('excelImportCollapsed') === 'true';

        // ====================== è·å–é¡µé¢å…ƒç´  ======================
        const tabBtns = document.querySelectorAll('.tab-btn');
        const quotaBtns = document.querySelectorAll('.quota-btn');
        const contentPanels = document.querySelectorAll('.content-panel');
        const minNumInput = document.getElementById('minNumInput');
        const maxNumInput = document.getElementById('maxNumInput');
        const excelFile = document.getElementById('excelFile');
        const fileName = document.getElementById('fileName');
        const parseExcelBtn = document.getElementById('parseExcelBtn');
        const nameCountTip = document.getElementById('nameCountTip');
        const displayArea = document.getElementById('displayArea');
        const lotteryBtn = document.getElementById('lotteryBtn');
        const winTip = document.getElementById('winTip');
        const roundDisplay = document.getElementById('roundDisplay');
        const currentRoundText = document.getElementById('currentRoundText');
        const prevRoundBtn = document.getElementById('prevRoundBtn');
        const nextRoundBtn = document.getElementById('nextRoundBtn');
        const remainingTip = document.getElementById('remainingTip');
        const winListAside = document.getElementById('winListAside');
        const winListContent = document.getElementById('winListContent');
        const refreshListBtn = document.getElementById('refreshListBtn');
        const clearAllListBtn = document.getElementById('clearAllListBtn');
        const downloadListBtn = document.getElementById('downloadListBtn');
        const collapseListBtn = document.getElementById('collapseListBtn');
        // æ–°å¢ï¼šExcelå¯¼å…¥æŠ˜å å…ƒç´ 
        const excelImportSection = document.getElementById('excelImportSection');
        const excelImportHeader = document.getElementById('excelImportHeader');
        const excelCollapseToggle = document.getElementById('excelCollapseToggle');
        const excelImportContent = document.getElementById('excelImportContent');

        // ====================== åˆå§‹åŒ– ======================
        window.addEventListener('load', function() {
            // åˆå§‹åŒ–é¢„è®¾æ•°æ®
            loadPresetData();
            // åˆå§‹åŒ–è½®æ•°æ˜¾ç¤º
            updateRoundDisplay();
            // åˆå§‹åŒ–å‰©ä½™åé¢æç¤º
            updateRemainingTip();
            // åˆå§‹åŒ–ä¸­å¥–åå•æ˜¾ç¤º
            renderWinList();
            // åˆå§‹åŒ–Excelå¯¼å…¥åŒºåŸŸæŠ˜å çŠ¶æ€
            initExcelImportCollapse();
            
            // ç»‘å®šè½®æ•°æ§åˆ¶æŒ‰é’®äº‹ä»¶
            prevRoundBtn.addEventListener('click', goToPrevRound);
            nextRoundBtn.addEventListener('click', goToNextRound);
            
            // ç»‘å®šæ ‡ç­¾åˆ‡æ¢äº‹ä»¶
            tabBtns.forEach(btn => {
                btn.addEventListener('click', switchTab);
            });
            // ç»‘å®šåé¢é€‰æ‹©äº‹ä»¶
            quotaBtns.forEach(btn => {
                btn.addEventListener('click', selectQuota);
            });
            // ç»‘å®šExcelä¸Šä¼ äº‹ä»¶
            excelFile.addEventListener('change', handleExcelSelect);
            // ç»‘å®šè§£æExceläº‹ä»¶
            parseExcelBtn.addEventListener('click', parseExcel);
            // ç»‘å®šæŠ½å¥–æŒ‰é’®äº‹ä»¶
            lotteryBtn.addEventListener('click', toggleLottery);
            // ç»‘å®šåå•åˆ·æ–°äº‹ä»¶
            refreshListBtn.addEventListener('click', renderWinList);
            // ç»‘å®šæ¸…ç©ºè®°å½•æŒ‰é’®äº‹ä»¶
            clearAllListBtn.addEventListener('click', clearAllWinRecords);
            // ç»‘å®šåå•ä¸‹è½½äº‹ä»¶
            downloadListBtn.addEventListener('click', downloadWinList);
            // ç»‘å®šåå•æ”¶èµ·/å±•å¼€äº‹ä»¶
            collapseListBtn.addEventListener('click', toggleListCollapse);
            // ç»‘å®šExcelå¯¼å…¥åŒºåŸŸæŠ˜å äº‹ä»¶
            excelImportHeader.addEventListener('click', toggleExcelImportCollapse);
            excelCollapseToggle.addEventListener('click', toggleExcelImportCollapse);

            // ç›‘å¬æœ¬åœ°å­˜å‚¨å˜åŒ–ï¼ˆåŒæ­¥---ä¿®æ”¹ï¼‰
            window.addEventListener('storage', function(e) {
                if (e.key === 'lotteryCurrentRound') {
                    currentRound = parseInt(e.newValue) || 1;
                    updateRoundDisplay();
                }
                if (e.key === 'lotteryWonSet') {
                    wonSet = new Set(JSON.parse(e.newValue) || []);
                    updateRemainingTip();
                }
                if (e.key === 'lotteryWinList') {
                    winList = JSON.parse(e.newValue) || [];
                    renderWinList();
                }
                if (e.key === 'lotteryNameList') {
                    nameList = JSON.parse(e.newValue) || [];
                    updateRemainingTip();
                    nameCountTip.textContent = `å·²å¯¼å…¥ ${nameList.length} ä¸ªå§“å`;
                }
                // ç›‘å¬é¢„è®¾è®¾ç½®å˜åŒ–
                if (e.key === 'lotteryPresetEnabled' || e.key === 'lotteryPresetNumbers' || 
                    e.key === 'lotteryPresetNames' || e.key === 'lotteryPresetUsedNumbers' || 
                    e.key === 'lotteryPresetUsedNames') {
                    loadPresetData();
                    updateRemainingTip();
                }
            });
        });

        // ====================== Excelå¯¼å…¥åŒºåŸŸæŠ˜å åŠŸèƒ½ ======================
        /**
         * åˆå§‹åŒ–Excelå¯¼å…¥åŒºåŸŸæŠ˜å çŠ¶æ€
         */
        function initExcelImportCollapse() {
            if (excelImportCollapsed) {
                excelImportSection.classList.add('collapsed');
            } else {
                excelImportSection.classList.remove('collapsed');
            }
        }

        /**
         * åˆ‡æ¢Excelå¯¼å…¥åŒºåŸŸæŠ˜å çŠ¶æ€
         */
        function toggleExcelImportCollapse(e) {
            e.stopPropagation(); // é˜²æ­¢äº‹ä»¶å†’æ³¡
            excelImportCollapsed = !excelImportCollapsed;
            
            if (excelImportCollapsed) {
                excelImportSection.classList.add('collapsed');
            } else {
                excelImportSection.classList.remove('collapsed');
            }
            
            // ä¿å­˜æŠ˜å çŠ¶æ€åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('excelImportCollapsed', excelImportCollapsed);
        }

        // ====================== é¢„è®¾æ•°æ®åŠ è½½ ======================
        function loadPresetData() {
            presetEnabled = localStorage.getItem('lotteryPresetEnabled') === 'true';
            presetNumbers = JSON.parse(localStorage.getItem('lotteryPresetNumbers')) || [];
            presetNames = JSON.parse(localStorage.getItem('lotteryPresetNames')) || [];
            presetUsedNumbers = new Set(JSON.parse(localStorage.getItem('lotteryPresetUsedNumbers')) || []);
            presetUsedNames = new Set(JSON.parse(localStorage.getItem('lotteryPresetUsedNames')) || []);
        }

        // ====================== è½®æ•°ç®¡ç†åŠŸèƒ½ ======================
        /**
         * æ›´æ–°è½®æ•°æ˜¾ç¤º
         */
        function updateRoundDisplay() {
            currentRoundText.textContent = `ç¬¬ ${currentRound} è½®`;
            // ç¦ç”¨/å¯ç”¨ä¸Šä¸€è½®æŒ‰é’®ï¼ˆé˜²æ­¢è½®æ•°å°äº1ï¼‰
            prevRoundBtn.disabled = currentRound <= 1;
            prevRoundBtn.style.opacity = currentRound <= 1 ? '0.5' : '1';
            // æŒä¹…åŒ–è½®æ•°
            localStorage.setItem('lotteryCurrentRound', currentRound);
        }

        /**
         * ä¸Šä¸€è½®
         */
        function goToPrevRound() {
            if (currentRound > 1) {
                currentRound--;
                updateRoundDisplay();
            }
        }

        /**
         * ä¸‹ä¸€è½®ï¼ˆæŠ½å¥–å®Œæˆåå¯æ‰‹åŠ¨åˆ‡æ¢ï¼Œä¹Ÿå¯åœ¨æŠ½å¥–åè‡ªåŠ¨åˆ‡æ¢ï¼‰
         */
        function goToNextRound() {
            currentRound++;
            updateRoundDisplay();
        }

        // ====================== æ ¸å¿ƒåŠŸèƒ½ï¼šé˜²é‡å¤ä¸­å¥–ç›¸å…³ ======================
        /**
         * æ›´æ–°å‰©ä½™å¯æŠ½å¥–åé¢æç¤º - ä¿®æ”¹ï¼šç§»é™¤é¢„è®¾å¯ç”¨ä¿¡æ¯æ˜¾ç¤º
         */
        function updateRemainingTip() {
            if (currentTab === 'number-tab') {
                // æ•°å­—æŠ½å¥–ï¼šè®¡ç®—èŒƒå›´å…§æœªä¸­å¥–çš„æ•°é‡
                const min = parseInt(minNumInput.value) || 1;
                const max = parseInt(maxNumInput.value) || 99;
                const total = max - min + 1;
                const wonCount = Array.from(wonSet).filter(item => {
                    const num = parseInt(item);
                    return !isNaN(num) && num >= min && num <= max;
                }).length;
                const remaining = total - wonCount;
                
                // ä¿®æ”¹ï¼šä¸å†æ˜¾ç¤ºé¢„è®¾å¯ç”¨ä¿¡æ¯
                remainingTip.textContent = `å‰©ä½™å¯æŠ½å¥–åé¢ï¼š${remaining} (æ€»${total}ä¸ª)`;
            } else {
                // å§“åæŠ½å¥–ï¼šè®¡ç®—å¯¼å…¥åå•ä¸­æœªä¸­å¥–çš„æ•°é‡
                const total = nameList.length;
                const wonCount = Array.from(wonSet).filter(item => nameList.includes(item)).length;
                const remaining = total - wonCount;
                
                // ä¿®æ”¹ï¼šä¸å†æ˜¾ç¤ºé¢„è®¾å¯ç”¨ä¿¡æ¯
                remainingTip.textContent = `å‰©ä½™å¯æŠ½å¥–åé¢ï¼š${remaining} (æ€»${total}ä¸ª)`;
            }
        }

        /**
         * è·å–æ‰€æœ‰å¯ç”¨çš„å€™é€‰åˆ—è¡¨
         * @returns {Array} æ‰€æœ‰å¯ç”¨å€™é€‰æ•°ç»„
         */
        function getAllAvailableCandidates() {
            let candidates = [];
            
            if (currentTab === 'number-tab') {
                // æ•°å­—æŠ½å¥–ï¼šç”ŸæˆèŒƒå›´å…§æœªä¸­å¥–çš„æ•°å­—
                const min = parseInt(minNumInput.value) || 1;
                const max = parseInt(maxNumInput.value) || 99;
                
                // è·å–æ‰€æœ‰æœªä¸­å¥–çš„æ•°å­—
                for (let i = min; i <= max; i++) {
                    if (!wonSet.has(i.toString())) {
                        candidates.push(i.toString());
                    }
                }
            } else {
                // å§“åæŠ½å¥–ï¼šè¿‡æ»¤å‡ºæœªä¸­å¥–çš„å§“å
                candidates = nameList.filter(name => !wonSet.has(name));
            }
            
            return candidates;
        }

        /**
         * è·å–é¢„è®¾å€™é€‰åˆ—è¡¨
         * @returns {Array} é¢„è®¾å€™é€‰æ•°ç»„
         */
        function getPresetCandidates() {
            let candidates = [];
            
            if (currentTab === 'number-tab') {
                // æ•°å­—æŠ½å¥–ï¼šè·å–é¢„è®¾æ•°å­—
                const min = parseInt(minNumInput.value) || 1;
                const max = parseInt(maxNumInput.value) || 99;
                
                candidates = presetNumbers.filter(num => {
                    const numStr = num.toString();
                    const numInt = parseInt(num);
                    return !presetUsedNumbers.has(numStr) && 
                           !isNaN(numInt) && 
                           numInt >= min && 
                           numInt <= max &&
                           !wonSet.has(numStr);
                }).map(num => num.toString());
            } else {
                // å§“åæŠ½å¥–ï¼šè·å–é¢„è®¾å§“å
                candidates = presetNames.filter(name => 
                    !presetUsedNames.has(name) && 
                    nameList.includes(name) &&
                    !wonSet.has(name)
                );
            }
            
            return candidates;
        }

        /**
         * è·å–æ‰€æœ‰å¯èƒ½çš„æ•°å­—ï¼ˆç”¨äºæ»šåŠ¨æ˜¾ç¤ºï¼‰
         * @returns {Array} æ‰€æœ‰å¯èƒ½çš„æ•°å­—æ•°ç»„
         */
        function getAllPossibleNumbers() {
            const min = parseInt(minNumInput.value) || 1;
            const max = parseInt(maxNumInput.value) || 99;
            const numbers = [];
            
            for (let i = min; i <= max; i++) {
                numbers.push(i.toString());
            }
            
            return numbers;
        }

        /**
         * è·å–æ‰€æœ‰å¯èƒ½çš„å§“åï¼ˆç”¨äºæ»šåŠ¨æ˜¾ç¤ºï¼‰
         * @returns {Array} æ‰€æœ‰å¯èƒ½çš„å§“åæ•°ç»„
         */
        function getAllPossibleNames() {
            return [...nameList];
        }

        /**
         * æ ‡è®°ä¸ºå·²ä¸­å¥–ï¼ˆåŠ å…¥wonSetå¹¶æŒä¹…åŒ–ï¼‰
         * @param {string} item ä¸­å¥–çš„å·ç /å§“å
         */
        function markAsWon(item) {
            wonSet.add(item);
            // æŒä¹…åŒ–åˆ°æœ¬åœ°å­˜å‚¨
            localStorage.setItem('lotteryWonSet', JSON.stringify(Array.from(wonSet)));
            
            // æ£€æŸ¥æ˜¯å¦ä¸ºé¢„è®¾ä¸­å¥–ï¼Œè®°å½•ä½¿ç”¨
            if (presetEnabled) {
                // æ£€æŸ¥æ˜¯å¦æ˜¯é¢„è®¾æ•°å­—
                const isPresetNumber = presetNumbers.some(num => 
                    num.toString() === item || (parseInt(num) === parseInt(item) && !isNaN(parseInt(item)))
                );
                
                if (isPresetNumber) {
                    presetUsedNumbers.add(item);
                    localStorage.setItem('lotteryPresetUsedNumbers', JSON.stringify(Array.from(presetUsedNumbers)));
                }
                
                // æ£€æŸ¥æ˜¯å¦æ˜¯é¢„è®¾å§“å
                if (presetNames.includes(item)) {
                    presetUsedNames.add(item);
                    localStorage.setItem('lotteryPresetUsedNames', JSON.stringify(Array.from(presetUsedNames)));
                }
            }
            
            // æ›´æ–°å‰©ä½™åé¢æç¤º
            updateRemainingTip();
        }

        // ====================== åŸæœ‰åŠŸèƒ½ï¼šæ ‡ç­¾åˆ‡æ¢ ======================
        function switchTab(e) {
            const targetTab = e.target.dataset.tab;
            // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            tabBtns.forEach(btn => btn.classList.remove('active'));
            contentPanels.forEach(panel => panel.classList.remove('active'));
            // æ¿€æ´»å½“å‰æ ‡ç­¾
            e.target.classList.add('active');
            document.getElementById(targetTab).classList.add('active');
            // æ›´æ–°å½“å‰æ ‡ç­¾
            currentTab = targetTab;
            // é‡ç½®æ˜¾ç¤ºåŒºåŸŸ
            displayArea.textContent = '0';
            // æ›´æ–°å‰©ä½™åé¢æç¤º
            updateRemainingTip();
        }

        // ====================== åŸæœ‰åŠŸèƒ½ï¼šåé¢é€‰æ‹© ======================
        function selectQuota(e) {
            const quota = parseInt(e.target.dataset.quota);
            // ç§»é™¤æ‰€æœ‰æ¿€æ´»çŠ¶æ€
            quotaBtns.forEach(btn => btn.classList.remove('active'));
            // æ¿€æ´»å½“å‰åé¢
            e.target.classList.add('active');
            // æ›´æ–°å½“å‰åé¢
            currentQuota = quota;
        }

        // ====================== åŸæœ‰åŠŸèƒ½ï¼šExcelå¤„ç† ======================
        function handleExcelSelect(e) {
            const file = e.target.files[0];
            if (file) {
                fileName.textContent = file.name;
                parseExcelBtn.disabled = false;
                // å­˜å‚¨æ–‡ä»¶å¯¹è±¡
                parseExcelBtn.dataset.file = file.name;
                parseExcelBtn.file = file;
            } else {
                fileName.textContent = 'æœªé€‰æ‹©æ–‡ä»¶';
                parseExcelBtn.disabled = true;
                delete parseExcelBtn.file;
            }
        }

        function parseExcel() {
            if (!parseExcelBtn.file) return;
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    // è·å–ç¬¬ä¸€ä¸ªå·¥ä½œè¡¨
                    const worksheet = workbook.Sheets[workbook.SheetNames[0]];
                    // è½¬æ¢ä¸ºæ•°ç»„ï¼ˆåªå–ç¬¬ä¸€åˆ—ï¼‰
                    const jsonData = XLSX.utils.sheet_to_json(worksheet, { header: ['name'] });
                    // è¿‡æ»¤ç©ºå€¼ï¼Œæå–å§“ååˆ—è¡¨
                    nameList = jsonData.map(item => item.name).filter(name => name && typeof name === 'string');
                    // å»é‡
                    nameList = [...new Set(nameList)];
                    // æŒä¹…åŒ–å§“ååˆ—è¡¨
                    localStorage.setItem('lotteryNameList', JSON.stringify(nameList));
                    // æ›´æ–°æç¤º
                    nameCountTip.textContent = `å·²å¯¼å…¥ ${nameList.length} ä¸ªå§“å`;
                    // æ›´æ–°å‰©ä½™åé¢æç¤º
                    updateRemainingTip();
                    alert(`æˆåŠŸè§£æExcelæ–‡ä»¶ï¼Œå…±å¯¼å…¥ ${nameList.length} ä¸ªæ•™å¸ˆå§“åï¼`);
                } catch (error) {
                    alert('Excelæ–‡ä»¶è§£æå¤±è´¥ï¼Œè¯·æ£€æŸ¥æ–‡ä»¶æ ¼å¼æ˜¯å¦æ­£ç¡®ï¼');
                    console.error('Excelè§£æé”™è¯¯ï¼š', error);
                }
            };
            reader.readAsArrayBuffer(parseExcelBtn.file);
        }

        // ====================== æ ¸å¿ƒåŠŸèƒ½ï¼šæŠ½å¥–é€»è¾‘ ======================
        function toggleLottery() {
            if (isLotteryRunning) {
                // åœæ­¢æŠ½å¥–
                stopLottery();
            } else {
                // å¼€å§‹æŠ½å¥–
                startLottery();
            }
        }

        function startLottery() {
            // éªŒè¯æŠ½å¥–æ¡ä»¶
            if (currentTab === 'name-tab' && nameList.length === 0) {
                alert('è¯·å…ˆå¯¼å…¥æ•™å¸ˆå§“åExcelæ–‡ä»¶ï¼');
                return;
            }

            // è·å–æ‰€æœ‰å¯ç”¨çš„å€™é€‰åˆ—è¡¨ï¼ˆåŒ…å«é¢„è®¾å’Œéé¢„è®¾ï¼‰
            availableCandidates = getAllAvailableCandidates();
            
            if (availableCandidates.length === 0) {
                alert('æ‰€æœ‰åé¢å·²ä¸­å¥–ï¼Œæ— å¯ç”¨æŠ½å¥–åé¢ï¼');
                return;
            }
            
            // è·å–é¢„è®¾å€™é€‰åˆ—è¡¨
            presetCandidates = getPresetCandidates();
            
            // è®¡ç®—å®é™…å¯æŠ½å¥–æ•°é‡
            const totalAvailable = availableCandidates.length;
            const presetAvailable = presetCandidates.length;
            
            if (totalAvailable < currentQuota) {
                alert(`å‰©ä½™å¯æŠ½å¥–åé¢ä¸è¶³ï¼ˆä»…${totalAvailable}ä¸ªï¼‰ï¼Œå·²è‡ªåŠ¨è°ƒæ•´ä¸º${totalAvailable}ä¸ªåé¢ï¼`);
                currentQuota = totalAvailable;
                // æ›´æ–°åé¢æŒ‰é’®é€‰ä¸­çŠ¶æ€
                quotaBtns.forEach(btn => {
                    if (parseInt(btn.dataset.quota) === currentQuota) {
                        btn.classList.add('active');
                    } else {
                        btn.classList.remove('active');
                    }
                });
            }

            // å‡†å¤‡å…¨èŒƒå›´åˆ—è¡¨ç”¨äºæ»šåŠ¨æ˜¾ç¤º
            if (currentTab === 'number-tab') {
                allPossibleNumbers = getAllPossibleNumbers();
            } else {
                allPossibleNames = getAllPossibleNames();
            }

            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            lotteryBtn.classList.remove('start');
            lotteryBtn.classList.add('stop');
            lotteryBtn.textContent = 'åœæ­¢æŠ½å¥–';
            winTip.style.display = 'none';
            isLotteryRunning = true;
            
            // åˆå§‹åŒ–æ˜¾ç¤ºéšæœºå†…å®¹
            renderRandomDisplay();

            // å¼€å§‹æ»šåŠ¨æŠ½å¥–
            lotteryTimer = setInterval(() => {
                renderRandomDisplay();
            }, 60);
        }

        function stopLottery() {
            // æ¸…é™¤å®šæ—¶å™¨
            clearInterval(lotteryTimer);
            // åˆ‡æ¢æŒ‰é’®çŠ¶æ€
            lotteryBtn.classList.remove('stop');
            lotteryBtn.classList.add('start');
            lotteryBtn.textContent = 'å¼€å§‹æŠ½å¥–';
            isLotteryRunning = false;

            // è·å–æœ€ç»ˆä¸­å¥–è€…ï¼ˆç¡®ä¿é¢„è®¾ä¼˜å…ˆï¼‰
            const winners = getFinalWinners(availableCandidates, presetCandidates, currentQuota);
            
            // æ¸²æŸ“ä¸­å¥–ç»“æœ
            renderDisplayArea(winners);
            // æ˜¾ç¤ºä¸­å¥–æç¤º
            winTip.style.display = 'block';

            // æ ‡è®°ä¸­å¥–è€…ä¸ºå·²ä¸­å¥–
            winners.forEach(winner => markAsWon(winner));

            // è®°å½•ä¸­å¥–ä¿¡æ¯
            recordWinInfo(winners);
            // æ›´æ–°ä¸­å¥–åå•æ˜¾ç¤º
            renderWinList();
            
            // æ¸…ç©ºä¸´æ—¶æ•°æ®
            availableCandidates = [];
            presetCandidates = [];
            allPossibleNumbers = [];
            allPossibleNames = [];
        }

        /**
         * æ¸²æŸ“éšæœºæ˜¾ç¤ºå†…å®¹ï¼ˆè‡ªç„¶æ»šåŠ¨æ•ˆæœï¼‰
         */
        function renderRandomDisplay() {
            if (currentTab === 'number-tab') {
                // æ•°å­—æŠ½å¥–ï¼šä»å…¨èŒƒå›´éšæœºé€‰æ‹©æ˜¾ç¤º
                const displayItems = getRandomDisplayItems(allPossibleNumbers, currentQuota);
                renderDisplayArea(displayItems);
            } else {
                // å§“åæŠ½å¥–ï¼šä»å…¨èŒƒå›´éšæœºé€‰æ‹©æ˜¾ç¤º
                const displayItems = getRandomDisplayItems(allPossibleNames, currentQuota);
                renderDisplayArea(displayItems);
            }
        }

        /**
         * ä»åˆ—è¡¨ä¸­è·å–éšæœºæ˜¾ç¤ºé¡¹
         * @param {Array} list æºåˆ—è¡¨
         * @param {number} count æ•°é‡
         * @returns {Array} éšæœºé¡¹æ•°ç»„
         */
        function getRandomDisplayItems(list, count) {
            if (list.length === 0) return ['0'];
            
            const result = [];
            const actualCount = Math.min(count, list.length);
            
            // éšæœºé€‰æ‹©ï¼Œå…è®¸é‡å¤ï¼Œè®©æ»šåŠ¨çœ‹èµ·æ¥æ›´è‡ªç„¶
            for (let i = 0; i < actualCount; i++) {
                const randomIndex = Math.floor(Math.random() * list.length);
                result.push(list[randomIndex]);
            }
            
            return result;
        }

        /**
         * è·å–æœ€ç»ˆä¸­å¥–è€…
         * @param {Array} allCandidates æ‰€æœ‰å€™é€‰
         * @param {Array} presetCandidates é¢„è®¾å€™é€‰
         * @param {number} count éœ€è¦çš„ä¸­å¥–æ•°é‡
         * @returns {Array} ä¸­å¥–è€…æ•°ç»„
         */
        function getFinalWinners(allCandidates, presetCandidates, count) {
            if (allCandidates.length === 0) return [];
            
            const result = [];
            
            // å¦‚æœéœ€è¦çš„ä¸­å¥–æ•°é‡è¶…è¿‡æ‰€æœ‰å¯ç”¨å€™é€‰ï¼Œåˆ™ä½¿ç”¨æ‰€æœ‰å¯ç”¨å€™é€‰
            const actualCount = Math.min(count, allCandidates.length);
            
            // å¦‚æœé¢„è®¾å¼€å¯ä¸”é¢„è®¾å€™é€‰ä¸ä¸ºç©º
            if (presetEnabled && presetCandidates.length > 0) {
                // å…ˆç¡®ä¿æ‰€æœ‰é¢„è®¾å€™é€‰éƒ½ä¸­å¥–ï¼ˆå¦‚æœé¢„è®¾æ•°é‡è¶³å¤Ÿï¼‰
                const presetCount = Math.min(actualCount, presetCandidates.length);
                
                // å¤åˆ¶é¢„è®¾å€™é€‰åˆ—è¡¨
                const presetTemp = [...presetCandidates];
                
                // ä»é¢„è®¾ä¸­éšæœºé€‰æ‹©ï¼ˆç¡®ä¿é¢„è®¾ä¼˜å…ˆä¸­å¥–ï¼‰
                for (let i = 0; i < presetCount; i++) {
                    const randomIndex = Math.floor(Math.random() * presetTemp.length);
                    result.push(presetTemp[randomIndex]);
                    presetTemp.splice(randomIndex, 1);
                }
                
                // å¦‚æœè¿˜éœ€è¦æ›´å¤šä¸­å¥–è€…ï¼Œä»å‰©ä½™å€™é€‰ä¸­é€‰æ‹©
                if (result.length < actualCount) {
                    // è·å–å‰©ä½™å€™é€‰ï¼ˆæ’é™¤å·²é€‰çš„é¢„è®¾ï¼‰
                    const remainingCandidates = allCandidates.filter(candidate => 
                        !result.includes(candidate)
                    );
                    
                    const remainingNeeded = actualCount - result.length;
                    const remainingTemp = [...remainingCandidates];
                    
                    for (let i = 0; i < remainingNeeded && remainingTemp.length > 0; i++) {
                        const randomIndex = Math.floor(Math.random() * remainingTemp.length);
                        result.push(remainingTemp[randomIndex]);
                        remainingTemp.splice(randomIndex, 1);
                    }
                }
            } else {
                // é¢„è®¾å…³é—­æˆ–æ²¡æœ‰é¢„è®¾å€™é€‰ï¼Œä»æ‰€æœ‰å€™é€‰ä¸­é€‰æ‹©
                const temp = [...allCandidates];
                for (let i = 0; i < actualCount; i++) {
                    const randomIndex = Math.floor(Math.random() * temp.length);
                    result.push(temp[randomIndex]);
                    temp.splice(randomIndex, 1);
                }
            }
            
            return result;
        }

        /**
         * æ¸²æŸ“æ˜¾ç¤ºåŒºåŸŸ
         * @param {Array} items è¦æ˜¾ç¤ºçš„å·ç /å§“åæ•°ç»„
         */
        function renderDisplayArea(items) {
            displayArea.innerHTML = '';
            
            if (items.length === 0) {
                displayArea.textContent = '0';
                return;
            }
            
            items.forEach(item => {
                const winnerItem = document.createElement('div');
                winnerItem.className = 'winner-item';
                winnerItem.textContent = item;
                displayArea.appendChild(winnerItem);
            });
        }

        /**
         * è®°å½•ä¸­å¥–ä¿¡æ¯åˆ°æœ¬åœ°å­˜å‚¨
         * @param {Array} winners ä¸­å¥–è€…æ•°ç»„
         */
        function recordWinInfo(winners) {
            if (winners.length === 0) return;
            
            const now = new Date();
            const timeStr = `${now.getFullYear()}-${(now.getMonth()+1).toString().padStart(2, '0')}-${now.getDate().toString().padStart(2, '0')} ${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            const type = currentTab === 'number-tab' ? 'æ•°å­—' : 'å§“å';
            
            winners.forEach(winner => {
                winList.push({
                    round: currentRound,
                    type: type,
                    content: winner,
                    time: timeStr
                });
            });

            // æŒä¹…åŒ–ä¸­å¥–åå•
            localStorage.setItem('lotteryWinList', JSON.stringify(winList));
        }

        // ====================== ä¸­å¥–åå•ç›¸å…³ï¼ˆä¼˜åŒ–æ˜¾ç¤ºæ•ˆæœï¼‰ ======================
        /**
         * æ¸²æŸ“ä¸­å¥–åå•
         */
        function renderWinList() {
            if (winList.length === 0) {
                winListContent.innerHTML = '<div class="empty-win-tip">æš‚æ— ä¸­å¥–è®°å½•</div>';
                return;
            }

            // å€’åºæ˜¾ç¤ºï¼ˆæœ€æ–°çš„åœ¨æœ€å‰é¢ï¼‰ä½†è¦ä¿æŒä¸åå°ä¸€è‡´çš„åºå·
            const reversedList = [...winList].reverse();
            let html = '';
            
            // è®¡ç®—æ€»è®°å½•æ•°ï¼Œç”¨äºç”Ÿæˆåºå·
            const totalRecords = winList.length;
            
            reversedList.forEach((item, index) => {
                // è®¡ç®—åºå·ï¼šä»æœ€æ–°çš„å¼€å§‹ç¼–å·ä¸º1ï¼Œé€’å‡
                const sequenceNumber = totalRecords - index;
                
                html += `
                    <div class="win-item">
                        <div class="win-index">${sequenceNumber}</div>
                        <div class="win-round">${item.round}è½®</div>
                        <div class="win-type">${item.type}</div>
                        <div class="win-content" title="${item.content}">${item.content}</div>
                        <div class="win-time">${item.time}</div>
                    </div>
                `;
            });
            winListContent.innerHTML = html;
        }

        /**
         * ä¸‹è½½ä¸­å¥–åå•
         */
        function downloadWinList() {
            if (winList.length === 0) {
                alert('æš‚æ— ä¸­å¥–è®°å½•å¯ä¸‹è½½ï¼');
                return;
            }

            // è½¬æ¢ä¸ºCSVæ ¼å¼ï¼ˆæ·»åŠ åºå·åˆ—ï¼‰
            const header = 'åºå·,æŠ½å¥–è½®æ•°,æŠ½å¥–ç±»å‹,ä¸­å¥–å†…å®¹,ä¸­å¥–æ—¶é—´\n';
            const content = winList.map((item, index) => 
                `${index + 1},${item.round},${item.type},${item.content},${item.time}`
            ).join('\n');
            const csv = header + content;
            const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `è‚²ä»ä¸­å­¦2025å¹´ä¼šä¸­å¥–åå•_${new Date().getTime()}.csv`;
            link.click();
            URL.revokeObjectURL(url);
            
            alert(`ä¸­å¥–åå•ä¸‹è½½æˆåŠŸï¼å…±åŒ…å« ${winList.length} æ¡è®°å½•ã€‚`);
        }

        // ====================== æ–°å¢ï¼šæ¸…ç©ºæ‰€æœ‰ä¸­å¥–è®°å½•åŠŸèƒ½ ======================
        /**
         * æ¸…ç©ºæ‰€æœ‰ä¸­å¥–è®°å½•ï¼ˆä¸ç®¡ç†åå°åŠŸèƒ½ä¸€è‡´ï¼‰
         */
        function clearAllWinRecords() {
            if (winList.length === 0) {
                alert('å½“å‰æ²¡æœ‰ä¸­å¥–è®°å½•å¯æ¸…ç©ºï¼');
                return;
            }
            
            if (confirm('âš ï¸ è­¦å‘Šï¼šç¡®è®¤æ¸…ç©ºæ‰€æœ‰ä¸­å¥–è®°å½•å—ï¼Ÿæ­¤æ“ä½œä¸å¯é€†ï¼\n\næ³¨æ„ï¼šæ­¤æ“ä½œåªä¼šæ¸…ç©ºä¸­å¥–è®°å½•ï¼Œä¸ä¼šå½±å“å…¶ä»–ç³»ç»Ÿæ•°æ®ï¼ˆå¦‚è½®æ•°ã€å§“ååˆ—è¡¨ç­‰ï¼‰ã€‚')) {
                // æ¸…ç©ºä¸­å¥–åå•æœ¬åœ°å­˜å‚¨
                localStorage.removeItem('lotteryWinList');
                winList = [];
                
                // åŒæ—¶æ¸…ç©ºå·²ä¸­å¥–é›†åˆï¼Œä»¥ä¾¿é‡æ–°æŠ½å¥–
                localStorage.removeItem('lotteryWonSet');
                wonSet = new Set();
                
                // æ¸…ç©ºé¢„è®¾å·²ä½¿ç”¨è®°å½•ï¼Œè®©é¢„è®¾å¯ä»¥é‡æ–°ä½¿ç”¨
                localStorage.removeItem('lotteryPresetUsedNumbers');
                localStorage.removeItem('lotteryPresetUsedNames');
                presetUsedNumbers = new Set();
                presetUsedNames = new Set();
                
                // æ›´æ–°æ˜¾ç¤º
                renderWinList();
                updateRemainingTip();
                
                alert('æ‰€æœ‰ä¸­å¥–è®°å½•å·²æ¸…ç©ºï¼\nç³»ç»Ÿå·²é‡ç½®ï¼Œå¯ä»¥é‡æ–°å¼€å§‹æŠ½å¥–ã€‚');
            }
        }

        function toggleListCollapse() {
            winListAside.classList.toggle('collapse');
        }
    </script>
</body>
</html>
